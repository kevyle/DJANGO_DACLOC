{% extends "base.html" %}
{% load static %}

{% block content %}
{# allow either `profile_user` (from get_profile) or `user` to be used as `profile` #}
{% with profile=profile_user|default:user viewer=current_user|default:user %}
<div class="profile-page">
  <div class="profile-header-top">
    <a href="{% url 'post_list' %}" class="back-link">&larr;</a>
    <div class="profile-header-title">
      <div class="profile-name">{{ profile.display_name|default:profile.username|capfirst }}</div>
      <div class="profile-count">{{ posts|length }} Posts</div>
    </div>
  </div>

  <div class="profile-summary">
    <div class="banner"></div>
    <div class="avatar-large">{{ profile.display_name|first|upper }}</div>
    <div class="profile-actions">
      {% if viewer and profile and viewer.id == profile.id %}
      <a href="#" class="btn btn-outline">Edit profile</a>
      {% else %}
      <a href="#" class="btn btn-primary">Follow</a>
      {% endif %}
    </div>
    <div class="profile-meta">
      <div class="display-name">{{ profile.display_name|default:profile.username|capfirst }}</div>
      <div class="handle">@{{ profile.username }}</div>
      {% if profile.email %}
      <div class="bio">{{ profile.email }}</div>
      {% endif %}
      {% comment %} Add more meta if available (location, joined) {% endcomment %}
      <div class="follow-stats">
        <strong>{{ posts|length }}</strong>
        <span>Posts</span>
        <strong>0</strong>
        <span>Following</span>
        <strong>0</strong>
        <span>Followers</span>
      </div>
    </div>
  </div>

  <div class="profile-tabs">
    <div class="tab active">Posts</div>
    <div class="tab">Media</div>
  </div>

  <div class="profile-posts">
    {% if posts %}
      {% for post in posts %}
      <article class="timeline-post">
        <div class="post-avatar">
          <div class="avatar-small">{{ post.author.display_name|first|upper }}</div>
        </div>
        <div class="post-body">
          <div class="post-header">
            <span class="username">{{ post.author.display_name|default:post.author.username|capfirst }}</span>
            <span class="handle">@{{ post.author.username }}</span>
            <span class="dot">Â·</span>
            <span class="time">{{ post.created_at }}</span>
          </div>
          <div class="post-text">{{ post.content|linebreaksbr }}</div>
          {% if post.image %}
          <div class="post-media"><img src="{{ post.image.url }}" alt="image"></div>
          {% endif %}
          {% if post.video %}
          <div class="post-media"><video controls src="{{ post.video.url }}"></video></div>
          {% endif %}
        </div>
      </article>
      {% endfor %}
    {% else %}
      <div class="empty-timeline">This user hasn't posted anything yet.</div>
    {% endif %}
  </div>
</div>

<style>
  /* Page container and spacing */
  .profile-page { max-width: 720px; margin: 28px auto; padding: 0 16px; }
  .profile-header-top { display:flex; align-items:center; gap:12px; padding:8px 0 16px; border-bottom:1px solid #2f3336; }
  .back-link { color:var(--text-color); text-decoration:none; font-size:22px; }
  .profile-header-title { display:flex; flex-direction:column; }
  .profile-name { font-weight:700; font-size:18px; }
  .profile-count { color:#71767b; font-size:13px; }

  /* Banner + avatar */
  .banner { width:100%; height:140px; border-radius:12px; background:linear-gradient(90deg,var(--primary-color),#7856ff); box-shadow: 0 6px 18px rgba(0,0,0,0.5); margin-bottom: -48px; }
  .profile-summary { padding-top:48px; display:flex; gap:16px; align-items:flex-start; border-bottom:1px solid #2f3336; position:relative; }
  .avatar-large { width:104px; height:104px; border-radius:50%; background:linear-gradient(135deg,var(--primary-color),#7856ff); flex-shrink:0; border:4px solid var(--background-color); box-shadow:0 6px 18px rgba(0,0,0,0.5); transform: translateY(-52px); margin-left:8px; }

  /* Meta and actions */
  .profile-meta { flex:1; padding-top:6px; }
  .display-name { font-size:20px; font-weight:700; }
  .handle { color:#71767b; margin-top:4px; }
  .bio { margin-top:8px; color:#e7e9ea; }
  .follow-stats { display:flex; gap:18px; margin-top:12px; color:#e7e9ea; align-items:center; }
  .follow-stats strong { margin-right:6px; }
  .profile-actions { position:absolute; right:16px; top:72px; }
  .btn { padding:8px 14px; border-radius:9999px; text-decoration:none; font-weight:700; }
  .btn-primary { background:var(--primary-color); color:white; }
  .btn-outline { border:1px solid rgba(255,255,255,0.06); color:var(--text-color); background:transparent; }

  /* Tabs */
  .profile-tabs { display:flex; gap:12px; padding:12px 0; border-bottom:1px solid #2f3336; }
  .tab { padding:10px 0; color:#71767b; cursor:pointer; }
  .tab.active { color:var(--text-color); font-weight:700; border-bottom:2px solid var(--primary-color); }

  /* Posts */
  .profile-posts { padding-top:18px; }
  .timeline-post { display:flex; gap:12px; padding:12px 0; border-bottom:1px solid #2f3336; }
  .post-avatar .avatar-small, .avatar-small { width:48px; height:48px; border-radius:50%; background:linear-gradient(135deg,#1d9bf0,#7856ff); }
  .post-body { flex:1; }
  .post-header { display:flex; align-items:center; gap:8px; color:#e7e9ea; font-weight:700; }
  .post-text { margin-top:6px; color:#e7e9ea; }
  .post-media img, .post-media video { width:100%; border-radius:12px; margin-top:8px; }
  .empty-timeline { padding:24px; color:#71767b; text-align:center; }

  /* Responsive tweaks */
  @media (max-width:640px) {
    .profile-page { padding: 0 12px; }
    .banner { height:110px; }
    .avatar-large { width:84px; height:84px; transform: translateY(-42px); }
    .profile-actions { top:56px; right:12px; }
  }
</style>
  {% endwith %}

  {% endblock %}